{% extends 'layout.html' %}

{% block title %}{{ portfolio.name }} - Portfolio Details{% endblock %}


{% block content %}

<h2 class="mb-3">ðŸ“ˆ {{ portfolio.name }}</h2>
<p class="text-muted">Portfolio ID: {{ portfolio.portfolio_id }}</p>

<a href="{{ url_for('add_symbol', portfolio_id=portfolio.portfolio_id) }}" class="btn btn-success mb-4">âž• Add Symbol</a>
<a href="{{ url_for('export_portfolio_excel', portfolio_id=portfolio.portfolio_id) }}" class="btn btn-outline-secondary mb-4 ms-2">
  ðŸ“¥ Export to Excel
</a>
<a href="{{ url_for('sector_exposure', portfolio_id=portfolio.portfolio_id) }}" class="btn btn-info mb-4 ms-2">
  ðŸ§­ View Sector Exposure
</a>


{% if symbols %}
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>Ticker</th>
                <th>Sector</th>
                <th>Current Price</th>
                <th>Shares</th>
                <th>Current Value</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for s in symbols %}
            <tr>
                <td>{{ s.ticker }}</td>
                <td>{{ s.sector }}</td>
                <td>${{ s.current_data.last_price }}</td>
                <td>{{ s.current_shares }}</td>
                <td>${{ s.current_value }}</td>
                <td>
                    <a href="{{ url_for('add_transaction', portfolio_id=portfolio.portfolio_id, symbol_id=s.symbol_id) }}" class="btn btn-sm btn-outline-primary">Add Txn</a>
                </td>
            </tr>

            {% if s.transactions %}
            <tr>
                <td colspan="6">
                    <table class="table table-bordered mt-2">
                        <thead class="table-light">
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Shares</th>
                                <th>Price</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for txn in s.transactions %}
                            <tr>
                                <td>{{ txn.transaction_date }}</td>
                                <td>{{ txn.transaction_type }}</td>
                                <td>{{ txn.shares }}</td>
                                <td>${{ txn.price }}</td>
                                <td>${{ txn.transaction_cost }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    {% set summary = s.get_summary() %}
                    <div><strong>Summary:</strong>
                        Bought: {{ summary.bought }} shares,
                        Sold: {{ summary.sold }} shares,
                        Avg Cost/Share: {{ summary.avg_cost }},
                        Total Cost: ${{ summary.total_cost }}
                    </div>
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No symbols in this portfolio yet.</p>
{% endif %}

<h4>ðŸ“Š Portfolio Summary</h4>
<p><strong>Total Market Value:</strong> ${{ portfolio_summary.market_value }}</p>
<p><strong>Total Invested Capital:</strong> ${{ portfolio_summary.total_cost }}</p>
<p><strong>Unrealised P&amp;L:</strong> ${{ portfolio_summary.pnl }}</p>
{% endblock %}